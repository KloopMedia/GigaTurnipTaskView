(this["webpackJsonpgigaturnip-taskview"]=this["webpackJsonpgigaturnip-taskview"]||[]).push([[0],{331:function(e,t,n){},539:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),i=n(78),r=n.n(i),s=(n(331),n(28)),o=n.n(s),l=n(45),u=n(8),j=n(79),d=n(32),b=n(138),h=n.n(b),O="api/v1/campaigns/",p="api/v1/taskstages/",f="api/v1/tasks/",g="/api/v1/notifications/",x=h.a.create({baseURL:"https://journal-bb5e3.uc.r.appspot.com/"});x.interceptors.request.use((function(e){var t=localStorage.getItem("token");return t&&(e.headers.Authorization="JWT "+t),e}),(function(e){return Promise.reject(e)}));var m=x,v=(n(277),n(149)),S=n(151),k=n(605),_=n(608),y=n(616),C=n(88);C.a.initializeApp({apiKey:"AIzaSyCXiwOUNsbzKH7sbSAZrqA9f7VOeCMdUOQ",authDomain:"gigaturnip-b6b5b.firebaseapp.com",projectId:"gigaturnip-b6b5b",storageBucket:"gigaturnip-b6b5b.appspot.com",messagingSenderId:"414429242328",appId:"1:414429242328:web:a4685f5ac6895ea767c8ad",measurementId:"G-Y8JTEJMTET"});var w=new C.a.auth.GoogleAuthProvider;C.a.firestore().settings({ignoreUndefinedProperties:!0});var I,T,E=function(){return w.setCustomParameters({prompt:"select_account"}),C.a.auth().signInWithPopup(w)},N=function(){return C.a.auth().signOut().then((function(){return localStorage.removeItem("token")})).then((function(){return window.location.reload()}))},D=C.a,L=n(2),A=c.a.createContext(),B=function(e){var t=e.children,n=Object(a.useState)(null),c=Object(u.a)(n,2),i=c[0],r=c[1];return Object(a.useEffect)((function(){D.auth().onAuthStateChanged((function(e){e&&(r(e),e.getIdToken(!0).then((function(e){localStorage.setItem("token",e)})))})),D.auth().onIdTokenChanged((function(e){e&&e.getIdToken(!1).then((function(e){localStorage.setItem("token",e)}))}))}),[]),Object(L.jsx)(A.Provider,{value:{currentUser:i},children:t})},F=n(307),J=function(e){var t=e.data;return Object(L.jsx)(F.a,{id:"ViewerTinyMCE",value:t,inline:!1,disabled:!0,tinymceScriptSrc:"/GigaTurnipTaskView/tinymce/tinymce.min.js",init:{plugins:"autoresize",toolbar:!1,menubar:!1,image_advtab:!0,importcss_append:!0}})},P=n(21),R=n(6),z=n(23),U=function(e,t,n){return n&&e?Object(z.a)(Object(z.a)({},e),t):t},G=function(){var e=Object(l.a)(o.a.mark((function e(t,n,a,c,i){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return i||(a({}),c({})),e.next=4,Promise.all(t.map(function(){var e=Object(l.a)(o.a.mark((function e(t){var r,s,l,u,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.name.lastIndexOf("."),s=t.name.substring(0,r),l=t.name.substring(r),console.log("NAME EXT",s,l),u=s.replace(/\./g,"_").replace(/ /g,"_")+l,console.log(u),j=n.child(u).put(t),a((function(e){var t=Object(R.a)({},u,{status:"loading",progress:0});return e?Object(z.a)(Object(z.a)({},e),t):t})),j.on(D.storage.TaskEvent.STATE_CHANGED,(function(e){var t=e.bytesTransferred/e.totalBytes*100;a((function(e){var n=Object(R.a)({},u,{status:"loading",progress:t});return e?Object(z.a)(Object(z.a)({},e),n):n}))}),(function(e){console.log(e)}),(function(){j.snapshot.ref.getDownloadURL().then((function(e){console.log("FILE PATH",j.snapshot.ref.fullPath);var t=j.snapshot.ref.fullPath,n=e;a((function(e){var t=Object(R.a)({},u,{status:"complete",progress:100,url:n});return U(e,t,i)})),c((function(e){var n=Object(R.a)({},u,t);return U(e,n,i)}))}))}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,c,i){return e.apply(this,arguments)}}(),W=n(613),q=function(e){return Object(L.jsxs)(_.a,{display:"flex",alignItems:"center",children:[Object(L.jsx)(_.a,{width:"100%",mr:1,children:Object(L.jsx)(W.a,Object(z.a)({variant:"determinate"},e))}),Object(L.jsx)(_.a,{minWidth:35,children:Object(L.jsx)(S.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},M=n(290),V=n(603),H=function(e){var t=e.schema,n=e.uiSchema,c=e.disabled,i=e.required,r=e.formContext,s=e.value,j=e.id,d=r.campaignId,b=r.chainId,h=r.stageId,O=r.userId,p=r.taskId,f=Object(a.useState)({}),g=Object(u.a)(f,2),x=g[0],m=g[1],v=Object(a.useState)({}),S=Object(u.a)(v,2),k=S[0],_=S[1],y=Object(a.useState)(""),C=Object(u.a)(y,2),w=C[0],I=C[1],T=Object(a.useState)(!1),E=Object(u.a)(T,2),N=E[0],A=E[1],B=Object(a.useState)(!1),F=Object(u.a)(B,2),J=F[0],U=F[1],W=Object(a.useState)(""),H=Object(u.a)(W,2),K=H[0],X=H[1],Y=Object(a.useState)({}),Q=Object(u.a)(Y,2),Z=Q[0],$=Q[1],ee=!(!n["ui:options"]||!n["ui:options"].private)&&n["ui:options"].private,te=!(!n["ui:options"]||!n["ui:options"].multiple)&&n["ui:options"].multiple,ne=Object.keys(x).length>0,ae=i&&!ne,ce=void 0;d&&b&&h&&O&&p&&(ce=D.storage(),ce=(ce=ee?ce.ref("private"):ce.ref("public")).child(d).child(b).child(h).child(O).child(p)),Object(a.useEffect)((function(){if(s&&Object.keys(s).length>0){console.log("value",s);var e=JSON.parse(s);$(e),Object.keys(e).forEach((function(t){se(e[t]).then((function(e){return m((function(n){return Object(z.a)(Object(z.a)({},n),{},Object(R.a)({},t,{url:e,status:"complete"}))}))}))}))}}),[s]);var ie=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Files selected: ",Object(P.a)(t.target.files)),e.next=3,G(Object(P.a)(t.target.files),ce,m,_,te);case 3:t.target.value=null;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){return e.onBlur(j,x)},se=function(e){return D.storage().ref(e).getDownloadURL()};Object(a.useEffect)((function(){var t=function(){var t=Object(l.a)(o.a.mark((function t(){var n,a,c,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="",te?(a=JSON.parse(s),c=Object(z.a)(Object(z.a)({},a),k),n=JSON.stringify(c)):n=JSON.stringify(k),t.next=5,e.onChange(n);case 5:t.next=13;break;case 7:return t.prev=7,t.t0=t.catch(0),i=JSON.stringify(k),console.error(t.t0),t.next=13,e.onChange(i);case 13:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();k&&Object.keys(k).length>0&&(console.log("fileLinks",k),t().then((function(){return re()})))}),[k]);var oe=function(){var t=Object(l.a)(o.a.mark((function t(n){var a,c,i,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n in(a=Z))){t.next=7;break}return delete a[n],c=JSON.stringify(a),t.next=6,e.onChange(c);case 6:re();case 7:i=Object(z.a)({},k),n in i&&(delete i[n],_(i)),r=Object(z.a)({},x),n in r&&(delete r[n],m(r)),console.log("DELETE LOG",r);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),le=function(){var e=Object(l.a)(o.a.mark((function e(t){var n,a,c,i,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Z,console.log("FILE CLICK VALUE",n),!(t in n)){e.next=23;break}return a=n[t],console.log(a),e.next=7,D.storage().ref().child(a).getMetadata();case 7:c=e.sent,i=c.contentType.split("/")[0],r=c.contentType.split("/")[1],console.log("FILE TYPE",i),e.t0=i,e.next="image"===e.t0?14:"video"===e.t0?18:22;break;case 14:return I(x[t].url),X(c.contentType),A(!0),e.abrupt("break",23);case 18:return I(x[t].url),X("quicktime"===r?"video/mp4":c.contentType),U(!0),e.abrupt("break",23);case 22:window.open(x[t].url,"_blank");case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){I(""),X(""),A(!1),U(!1)};return Object(L.jsxs)("div",{children:[N&&Object(L.jsx)(M.a,{src:[w],disableScroll:!1,backgroundStyle:{backgroundColor:"rgba(0,0,0,0.8)"},closeOnClickOutside:!0,onClose:ue}),Object(L.jsx)(V.a,{open:J,onClose:ue,fullWidth:!0,children:Object(L.jsxs)("video",{height:"360px",controls:!0,children:[Object(L.jsx)("source",{src:w,type:K}),"Your browser does not support the video tag."]})}),Object(L.jsx)("label",{className:"form-label",children:null===t||void 0===t?void 0:t.title}),Object(L.jsx)("br",{}),Object(L.jsx)("input",{disabled:c,required:ae,multiple:te,type:"file",onChange:ie,onBlur:re,onFocus:function(){return e.onFocus(j,x)}}),Object.keys(x).map((function(e,t){return Object(L.jsxs)("div",{children:[Object(L.jsxs)("div",{style:{display:"flex",alignItems:"baseline"},children:[Object(L.jsx)("p",{children:e}),"complete"===x[e].status&&Object(L.jsxs)("div",{style:{display:"flex",alignItems:"baseline"},children:[Object(L.jsx)("button",{onClick:function(){return le(e)},style:{fontSize:"14px",padding:0,margin:"0 10px"},type:"button",className:"btn btn-link text-success",children:"\u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0444\u0430\u0439\u043b"}),!c&&Object(L.jsx)("button",{onClick:function(){return oe(e)},style:{fontSize:"14px",padding:0,margin:"0 10px"},type:"button",className:"btn btn-link text-danger",children:"\u0443\u0434\u0430\u043b\u0438\u0442\u044c"})]})]}),"loading"===x[e].status&&Object(L.jsx)(q,{value:x[e].progress})]},e)}))]})},K=n(22),X=function(e){var t,n,c,i=e.id,r=e.placeholder,s=e.required,o=e.readonly,l=e.disabled,j=e.label,d=e.value,b=e.onChange,O=e.onBlur,p=e.onFocus,f=e.autofocus,g=e.options,x=e.schema,m=e.rawErrors,v=void 0===m?[]:m,S=null!==(t=g.searchField)&&void 0!==t?t:"search",k=null!==(n=g.responseField)&&void 0!==n?n:"text",_=null!==(c=null===g||void 0===g?void 0:g.params)&&void 0!==c?c:"",y=Object(a.useState)([]),C=Object(u.a)(y,2),w=C[0],I=C[1],T=function(){if(g.webhook){var e="".concat(g.webhook,"?").concat(S,"=").concat(d+_);h.a.get(e).then((function(e){return e.data})).then((function(e){return I(e.results)})).catch((function(e){return console.log(e)}))}},E="string"===x.type?"text":"".concat(x.type);return Object(L.jsxs)(K.a.Group,{className:"mb-0",children:[Object(L.jsxs)(K.a.Label,{className:v.length>0?"text-danger":"",children:[j||x.title,(j||x.title)&&s?"*":null]}),Object(L.jsx)(K.a.Control,{id:i,placeholder:r,autoFocus:f,required:s,disabled:l,readOnly:o,className:v.length>0?"is-invalid":"",list:"examples_".concat(i),type:E,value:d||0===d?d:"",onChange:function(e){var t=e.target.value;return T(),b(""===t?g.emptyValue:t)},onBlur:function(e){var t=e.target.value;return O(i,t)},onFocus:function(e){var t=e.target.value;return p(i,t)}}),w&&w.length>0?Object(L.jsx)("datalist",{id:"examples_".concat(i),children:w.map((function(e,t){return Object(L.jsx)("option",{value:e[k]},"".concat(e[k],"_").concat(t))}))}):null]})},Y=function(e){var t=e.id,n=e.schema,a=e.options,c=e.value,i=e.required,r=e.disabled,s=e.readonly,o=e.label,l=e.onChange,u=e.onBlur,j=e.onFocus,d=a.enumOptions,b=a.enumDisabled,h=function(e){var t=e.target.value;return l("boolean"==n.type?"false"!==t:t)},O=function(e){var n=e.target.value;return u(t,n)},p=function(e){var n=e.target.value;return j(t,n)},f=Boolean(a&&a.inline);return Object(L.jsxs)(K.a.Group,{className:"mb-0",children:[Object(L.jsxs)(K.a.Label,{className:"d-block",children:[o||n.title,(o||n.title)&&i?"*":null]}),d.map((function(e,n){var a=Array.isArray(b)&&-1!==b.indexOf(e.value),o=e.value==c;return Object(L.jsx)(K.a.Check,{inline:f,label:e.label,id:"".concat(t,"_").concat(e.label),name:t,type:"radio",disabled:r||a||s,checked:o,required:i,value:e.value,onChange:h,onBlur:O,onFocus:p},n)}))]})},Q=function(e){var t=e.required,n=e.label,a=e.value,c=e.schema,i=e.rawErrors,r=void 0===i?[]:i;return a?Object(L.jsxs)(K.a.Group,{className:"mb-0",children:[Object(L.jsxs)(K.a.Label,{className:r.length>0?"text-danger":"",children:[n||c.title,(n||c.title)&&t?"*":null]}),Object(L.jsx)("br",{}),Object(L.jsx)("a",{href:a,children:a})]}):null},Z=n(35),$=n(291),ee=n(615),te=n(293),ne=n.n(te),ae=n(292),ce=n.n(ae),ie=n(70),re=n(145),se={customfile:H,autocomplete:X,RadioWidget:Y,customlink:Q,audio:function(e){e.schema;var t=e.id,n=e.options,c=e.value,i=e.required,r=e.disabled,s=e.readonly,j=e.label,d=e.formContext,b=e.onChange,h=e.onBlur,O=Object(a.useState)(null),p=Object(u.a)(O,2),f=p[0],g=p[1],x=Object(a.useState)(!1),m=Object(u.a)(x,2),v=m[0],S=m[1],C=d.campaignId,w=d.chainId,E=d.stageId,N=d.userId,A=d.taskId,B=!!n.private&&n.private,F=!!n.default&&n.default,J=void 0;C&&w&&E&&N&&A&&(J=D.storage(),J=(J=B?J.ref("private"):J.ref("public")).child(C).child(w).child(E).child(N).child(A)),Object(a.useEffect)((function(){F?g(n.default):c&&D.storage().ref(c).getDownloadURL().then((function(e){g(e)}))}),[]);var P=re.a.div(I||(I=Object(Z.a)(["\n      width: 10px;\n      height: 10px;\n      margin-left: 8px;\n      border-radius: 50%;\n      background-color: red;\n      animation: "," 1s linear infinite;\n    "])),Object(ie.c)(T||(T=Object(Z.a)(["50% {opacity: 0;}"])))),R=function(){var e=Object(l.a)(o.a.mark((function e(n,a){var c,i,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),g(n),c=a.type.split("/")[1],i=t.replace(/\./g,"_").replace(/ /g,"_")+"."+c,e.next=6,J.child(i).put(a).then((function(e){return e.ref.fullPath}));case 6:r=e.sent,S(!1),b(r),h(t,r);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),z=Object($.useReactMediaRecorder)({video:!1,onStop:R}),U=z.status,G=z.startRecording,W=z.stopRecording;return Object(L.jsxs)(_.a,{children:[Object(L.jsxs)("label",{className:"form-label",children:[j,i&&"*"]}),!F&&Object(L.jsxs)(k.a,{container:!0,alignItems:"center",children:[Object(L.jsx)(k.a,{item:!0,children:function(e){switch(e){case"recording":return Object(L.jsx)(ee.a,{variant:"contained",onClick:W,sx:{marginBottom:1},disabled:r||s,endIcon:Object(L.jsx)(ce.a,{}),children:"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c"});default:return Object(L.jsx)(ee.a,{variant:"contained",onClick:G,sx:{marginBottom:1},disabled:r||s,endIcon:Object(L.jsx)(ne.a,{sx:{fill:r||s?"grey":"red"}}),children:"\u0417\u0430\u043f\u0438\u0441\u044c"})}}(U)}),Object(L.jsx)(k.a,{item:!0,children:"recording"===U&&Object(L.jsx)(P,{})}),Object(L.jsx)(k.a,{item:!0,children:v&&Object(L.jsx)(y.a,{sx:{marginLeft:1},size:30})})]}),f&&Object(L.jsx)(k.a,{container:!0,children:Object(L.jsx)("audio",{controls:!0,src:f})})]})}},oe=function(e,t,n){var a=e.results,c=e.count,i=Math.ceil(c/10);console.log("numOfPages",i),console.log("results",a),t(a),n(i)},le=function(e,t){return t&&t>0?"".concat(e,"&limit=10&offset=").concat(10*(t-1)):e},ue=function(e){var t=new Date(e),n=t.getFullYear(),a=je(t.getMonth()+1),c=je(t.getDate()),i=je(t.getHours()),r=je(t.getMinutes()),s=je(t.getSeconds());return"".concat(c,"/").concat(a,"/").concat(n," ").concat(i,":").concat(r,":").concat(s)},je=function(e){return e<10?"0"+e:e},de=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},be=function(e){return m.post(f+e+"/request_assignment/")},he=function(e,t,n){console.log(t);var a=le("".concat(f,"user_selectable/?stage__chain__campaign=").concat(e),t);return n&&(n.query&&(a+="&search=".concat(n.query)),n.stage&&(a+="&stage=".concat(n.stage))),console.log("SELECTABLE URL",a),m.get(a).then((function(e){return console.log("getSelectableTasks",e.data),e.data}))},Oe=function(e){return m.get("".concat(f,"user_relevant/?complete=",!0,"&stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return console.log("getCompleteTasks",e),e}))},pe=function(e){return m.get("".concat(f,"user_relevant/?complete=",!1,"&stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return console.log("getOpenTasks",e),e}))},fe=function(e){return m.get("".concat(f+e,"/list_displayed_previous/")).then((function(e){return e.data}))},ge=function(e){return m.get("".concat(f+e,"/")).then((function(e){return e.data}))},xe=function(e,t,n,a){console.log(a);var c=le("".concat(g,"list_user_notifications/?campaign=").concat(e,"&viewed=").concat(t),a);return console.log("IMPORTANCE",n),0===n?m.get("".concat(c,"&importance=").concat(n)).then((function(e){return e.data})):m.get(c).then((function(e){return e.data}))},me=function(){var e=Object(d.h)(),t=e.id,n=e.campaignId,c=Object(d.g)(),i=Object(a.useContext)(A).currentUser,r="/campaign/".concat(n,"/tasks"),s=Object(a.useState)({}),b=Object(u.a)(s,2),h=b[0],O=b[1],p=Object(a.useState)({}),g=Object(u.a)(p,2),x=g[0],C=g[1],w=Object(a.useState)({}),I=Object(u.a)(w,2),T=I[0],E=I[1],N=Object(a.useState)(!1),D=Object(u.a)(N,2),B=D[0],F=D[1],P=Object(a.useState)([]),R=Object(u.a)(P,2),z=R[0],U=R[1],G=Object(a.useState)({}),W=Object(u.a)(G,2),q=W[0],M=W[1],V=Object(a.useState)(""),H=Object(u.a)(V,2),K=H[0],X=H[1],Y=Object(a.useState)(!1),Q=Object(u.a)(Y,2),Z=Q[0],$=Q[1],ee=Object(a.useState)(!1),te=Object(u.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),ie=Object(u.a)(ce,2),re=ie[0],oe=ie[1],le=Object(a.useState)(!1),ue=Object(u.a)(le,2),je=ue[0],de=ue[1],be=Object(a.useState)(!1),he=Object(u.a)(be,2),Oe=he[0],pe=he[1],xe=se;Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(o.a.mark((function e(){var a,c,r,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge(t);case 2:return a=e.sent,c=a.stage,console.log(a),c&&c.rich_text&&X(c.rich_text),M({campaignId:n.toString(),chainId:c.chain.id.toString(),stageId:c.id.toString(),userId:i.uid,taskId:a.id.toString()}),r=c.json_schema?JSON.parse(c.json_schema):{},s=c.ui_schema?JSON.parse(c.ui_schema):{},e.next=11,fe(t).then((function(e){return e.map((function(e){return{responses:e.responses,json_schema:e.stage.json_schema?JSON.parse(e.stage.json_schema):{},ui_schema:e.stage.ui_schema?JSON.parse(e.stage.ui_schema):{}}}))}));case 11:l=e.sent,U(l),E(a.responses),O(r),C(s),F(a.complete),oe(a.reopened),de(c.allow_go_back),pe(c.allow_release),ae(!0);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t&&i&&(console.log("SET DATA"),e())}),[t,i]);return Object(L.jsxs)("div",{style:{width:"70%",minWidth:"400px",margin:"0 auto",display:"block",padding:10},children:[Object(L.jsx)(d.a,{message:function(e,n){console.log("Backing up...");var a={responses:T};return B||m.patch(f+t+"/",a).then((function(){return console.log("Data Saved")})),!0}}),re&&Object(L.jsx)(S.a,{variant:"h6",color:"red",children:"\u042d\u0442\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u0431\u044b\u043b\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043e"}),""!==K&&Object(L.jsx)("div",{style:{paddingBottom:20},children:Object(L.jsx)(J,{data:K})}),z.length>0&&Object(L.jsx)(k.a,{children:z.map((function(e,t){var n,a,c;return Object(L.jsx)(j.a,{schema:null!==(n=e.json_schema)&&void 0!==n?n:{},uiSchema:null!==(a=e.ui_schema)&&void 0!==a?a:{},formData:null!==(c=e.responses)&&void 0!==c?c:{},widgets:xe,disabled:!0,children:" "},"prev_task_".concat(t))}))}),Object(L.jsx)(k.a,{children:Object(L.jsx)(j.a,{schema:h,uiSchema:x,formData:T,formContext:q,liveOmit:!0,omitExtraData:!0,widgets:xe,disabled:B,onBlur:function(){var e={responses:T};console.log("Saving data",e),m.patch(f+t+"/",e).catch((function(e){console.log(e)}))},onChange:function(e){E(e.formData)},onSubmit:function(){console.log("submit"),$(!0);var e={responses:T,complete:!0};m.patch(f+t+"/",e).then((function(e){console.log(e),$(!1),e.data.next_direct_id?(O({}),C({}),E({}),c.push("".concat(r,"/").concat(e.data.next_direct_id))):c.push(r)})).catch((function(e){$(!1),c.push(r)}))},children:Object(L.jsxs)(_.a,{display:"flex",children:[Object(L.jsx)(v.a,{type:"submit",style:{marginRight:"8px"},disabled:B||Z||!ne,children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),je&&Object(L.jsx)(v.a,{style:{margin:"0 8px"},disabled:B||Z||!ne,onClick:function(){m.get(f+t+"/open_previous/").then((function(e){O({}),C({}),E({}),c.push("".concat(r,"/").concat(e.data.id))}))},children:"\u041a \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u043c\u0443 \u0442\u0430\u0441\u043a\u0443"}),Oe&&Object(L.jsx)(v.a,{variant:"danger",disabled:B||Z||!ne,style:{margin:"0 8px"},onClick:function(){m.post(f+t+"/release_assignment/").then((function(){return c.push(r)}))},children:"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"}),Z&&Object(L.jsx)(_.a,{paddingLeft:2,children:Object(L.jsx)(y.a,{})})]})})})]})},ve=n(7),Se=n(30),ke=n(602),_e=n(609),ye=n(610),Ce=n(612),we=n(588),Ie=n(589),Te=n(611),Ee=n(297),Ne=n.n(Ee),De=n(299),Le=n.n(De),Ae=n(298),Be=n.n(Ae),Fe=n(599),Je=n(590),Pe=n(591),Re=n(294),ze=n.n(Re),Ue=n(295),Ge=n.n(Ue),We="GigaTurnip Tasks",qe=200,Me=function(e){return{width:qe,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"}},Ve=function(e){return Object(R.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"calc(".concat(e.spacing(7)," + 1px)")},e.breakpoints.up("sm"),{width:"calc(".concat(e.spacing(7)," + 1px)")})},He=Object(ve.a)("div")((function(e){var t=e.theme;return Object(z.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),Ke=Object(ve.a)(_e.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(z.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:qe,width:"calc(100% - ".concat(qe,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),Xe=Object(ve.a)(ke.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(z.a)(Object(z.a)({width:qe,flexShrink:0,whiteSpace:"nowrap",boxSizing:"border-box"},n&&Object(z.a)(Object(z.a)({},Me(t)),{},{"& .MuiDrawer-paper":Me(t)})),!n&&Object(z.a)(Object(z.a)({},Ve(t)),{},{"& .MuiDrawer-paper":Ve(t)}))})),Ye=function(e){var t=Object(Se.a)(),n=Object(d.g)(),c=Object(d.h)().campaignId,i=Object(a.useContext)(A).currentUser,r=e.children,s=Object(a.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1],b=function(e){e?n.push("/campaign/".concat(c,"/").concat(e)):n.push("/")},h=[{page:"tasks",title:"\u0417\u0430\u0434\u0430\u043d\u0438\u044f",icon:Object(L.jsx)(ze.a,{})},{page:"notifications",title:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f",icon:Object(L.jsx)(Ge.a,{})}];return Object(L.jsxs)(_.a,{sx:{display:"flex"},children:[Object(L.jsx)(we.a,{}),Object(L.jsx)(Ke,{position:"fixed",open:l,children:Object(L.jsxs)(ye.a,{children:[Object(L.jsx)(Te.a,{color:"inherit","aria-label":"open drawer",onClick:function(){j(!0)},edge:"start",sx:Object(z.a)({marginRight:"36px"},l&&{display:"none"}),children:Object(L.jsx)(Ne.a,{})}),Object(L.jsx)(S.a,{variant:"h6",noWrap:!0,component:"div",sx:{cursor:"pointer",flexGrow:1},onClick:function(){return b()},children:We}),Object(L.jsx)(S.a,{children:null===i||void 0===i?void 0:i.email}),i?Object(L.jsx)(ee.a,{onClick:N,color:"inherit",children:"\u0412\u044b\u0439\u0442\u0438"}):Object(L.jsx)(ee.a,{onClick:E,color:"inherit",children:"\u0412\u043e\u0439\u0442\u0438"})]})}),Object(L.jsxs)(Xe,{variant:"permanent",open:l,children:[Object(L.jsx)(He,{children:Object(L.jsx)(Te.a,{onClick:function(){j(!1)},children:"rtl"===t.direction?Object(L.jsx)(Be.a,{}):Object(L.jsx)(Le.a,{})})}),Object(L.jsx)(Ie.a,{}),Object(L.jsx)(Ce.a,{children:h.map((function(e){return Object(L.jsxs)(Fe.a,{button:!0,onClick:function(){return b(e.page)},children:[Object(L.jsx)(Je.a,{children:e.icon}),Object(L.jsx)(Pe.a,{primary:e.title})]},e.page)}))})]}),Object(L.jsxs)(_.a,{component:"main",sx:{flexGrow:1,p:0},children:[Object(L.jsx)(He,{}),r]})]})},Qe=n(54),Ze=Object(ve.a)("div")((function(e){var t=e.theme;return Object(z.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),$e=function(e){var t=e.children,n=Object(a.useContext)(A).currentUser;Object(d.g)();return Object(L.jsxs)(_.a,{sx:{flexGrow:1},children:[Object(L.jsx)(_e.a,{position:"static",children:Object(L.jsxs)(ye.a,{children:[Object(L.jsx)(S.a,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:We}),Object(L.jsx)(S.a,{children:null===n||void 0===n?void 0:n.email}),n?Object(L.jsx)(ee.a,{onClick:N,color:"inherit",children:"\u0412\u044b\u0439\u0442\u0438"}):Object(L.jsx)(ee.a,{onClick:E,color:"inherit",children:"\u0412\u043e\u0439\u0442\u0438"})]})}),Object(L.jsxs)(_.a,{component:"main",sx:{flexGrow:1,p:3},children:[Object(L.jsx)(Ze,{}),t]})]})},et=n(617),tt=n(619),nt=n(618),at=function(e){var t=e.data,n=t.id,a=t.name,c=t.description,i=t.campaign,r=e.onCardButtonClick,s=e.openCampaignInfo,o=e.selectable;return Object(L.jsxs)(et.a,{sx:{width:300},children:[Object(L.jsxs)(nt.a,{children:[Object(L.jsx)(S.a,{variant:"h5",component:"h2",gutterBottom:!0,children:a}),Object(L.jsxs)(S.a,{variant:"subtitle2",color:"textSecondary",children:["ID: ",n," ",i&&"Campaign: ".concat(i)]}),Object(L.jsx)(S.a,{variant:"body1",component:"p",children:c||Object(L.jsx)("br",{})})]}),Object(L.jsx)(tt.a,{children:o?Object(L.jsx)(ee.a,{size:"small",onClick:function(){s&&s(n)},children:"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435"}):Object(L.jsx)(ee.a,{size:"small",onClick:function(){r(n)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},ct=function(){var e=Object(a.useState)([]),t=Object(u.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)([]),r=Object(u.a)(i,2),s=r[0],o=r[1],l=Object(d.g)();Object(a.useEffect)((function(){m.get(O+"list_user_campaigns/").then((function(e){return e.data})).then((function(e){return console.log("user_campaigns",e),e})).then((function(e){return c(e)})),m.get(O+"list_user_selectable/").then((function(e){return e.data})).then((function(e){return console.log("selectable_campaigns",e),e})).then((function(e){return o(e)}))}),[]);var j=function(e){l.push("/campaign/about/".concat(e))},b=function(e){l.push("/campaign/".concat(e,"/tasks"))};return Object(L.jsxs)(k.a,{children:[n&&n.length>0&&Object(L.jsxs)(k.a,{children:[Object(L.jsx)(S.a,{align:"center",variant:"h4",children:"\u041c\u043e\u0438 \u043a\u0430\u043c\u043f\u0430\u043d\u0438\u0438"}),Object(L.jsx)(k.a,{container:!0,justifyContent:"center",children:n.map((function(e){return Object(L.jsx)(k.a,{item:!0,style:{padding:10},children:Object(L.jsx)(at,{data:e,onCardButtonClick:b,openCampaignInfo:j,selectable:!1})},e.id)}))})]}),s&&s.length>0&&Object(L.jsxs)(k.a,{children:[Object(L.jsx)(S.a,{align:"center",variant:"h4",children:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043a\u0430\u043c\u043f\u0430\u043d\u0438\u0438"}),Object(L.jsx)(k.a,{container:!0,justifyContent:"center",children:s.map((function(e){return Object(L.jsx)(k.a,{item:!0,style:{padding:10},children:Object(L.jsx)(at,{data:e,onCardButtonClick:b,openCampaignInfo:j,selectable:!0})},e.id)}))})]})]})},it=n(144),rt=["children","value","index"],st=function(e){var t=e.children,n=e.value,a=e.index,c=Object(it.a)(e,rt);return Object(L.jsx)("div",Object(z.a)(Object(z.a)({role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},c),{},{children:n===a&&Object(L.jsx)(_.a,{children:t})}))},ot=n(595),lt=n(620),ut=function(e){var t=e.value,n=e.handleChange;return Object(L.jsxs)(_.a,{sx:{width:"100%",bgcolor:"background.paper"},children:[Object(L.jsxs)(ot.a,{value:t,onChange:n,centered:!0,variant:"fullWidth",children:[Object(L.jsx)(lt.a,Object(z.a)({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},de(0))),Object(L.jsx)(lt.a,Object(z.a)({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},de(1))),e.showSelectable&&Object(L.jsx)(lt.a,Object(z.a)({label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435"},de(2)))]}),e.children]})},jt=function(e){var t=e.id,n=e.complete,a=e.reopened,c=e.name,i=e.description,r=e.creatable,s=e.selectable,o=e.integrated,l=Object(d.g)(),u=function(){o?l.push("".concat(l.location.pathname,"/").concat(t,"/integrated")):l.push("".concat(l.location.pathname,"/").concat(t))},j=function(){(function(e){return m.post(p+e+"/create_task/").then((function(e){return e.data}))})(t).then((function(e){return l.push("".concat(l.location.pathname,"/").concat(e.id))})).catch((function(e){return alert(e)}))},b=function(){be(t).then((function(e){return l.push("".concat(l.location.pathname,"/").concat(t))})).catch((function(e){return alert(e)}))};return Object(L.jsxs)(et.a,{sx:{width:300},children:[Object(L.jsxs)(nt.a,{children:[Object(L.jsx)(S.a,{variant:"h5",component:"span",gutterBottom:!0,children:c}),Object(L.jsx)("br",{}),Object(L.jsx)(S.a,{variant:"subtitle2",component:"span",children:t&&!r?"ID: ".concat(t):Object(L.jsx)("br",{})}),Object(L.jsx)("br",{}),Object(L.jsx)(S.a,{variant:"body1",component:"span",children:i||Object(L.jsx)("br",{})})]}),Object(L.jsx)(tt.a,{children:s?Object(L.jsx)(ee.a,{size:"small",onClick:b,children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"}):r?Object(L.jsx)(ee.a,{size:"small",onClick:j,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}):Object(L.jsxs)(k.a,{container:!0,children:[Object(L.jsx)(_.a,{flex:1,children:Object(L.jsx)(ee.a,{size:"small",onClick:u,children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})}),!n&&a&&Object(L.jsx)(S.a,{variant:"subtitle1",color:"red",children:"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043e"})]})})]})},dt=n(621),bt=n(622),ht=n(304),Ot=n.n(ht),pt=function(e){var t=e.id,n=e.taskData,c=e.isAssigned,i=e.integrated,r=e.refreshTasks,s=e.handleAssignment,b=Object(d.h)().campaignId,h=Object(a.useContext)(A).currentUser,O=Object(a.useState)({}),p=Object(u.a)(O,2),g=p[0],x=p[1],S=Object(a.useState)({}),C=Object(u.a)(S,2),w=C[0],I=C[1],T=Object(a.useState)({}),E=Object(u.a)(T,2),N=E[0],D=E[1],B=Object(a.useState)(!1),F=Object(u.a)(B,2),J=F[0],P=F[1],R=Object(a.useState)([]),z=Object(u.a)(R,2),U=z[0],G=z[1],W=Object(a.useState)({}),q=Object(u.a)(W,2),M=q[0],V=q[1],H=Object(a.useState)(!1),K=Object(u.a)(H,2),X=K[0],Y=K[1],Q=Object(a.useState)(!1),Z=Object(u.a)(Q,2),$=Z[0],ee=Z[1],te=Object(a.useState)(!1),ne=Object(u.a)(te,2),ae=ne[0],ce=ne[1],ie=se;Object(a.useEffect)((function(){n&&h&&function(){var e=Object(l.a)(o.a.mark((function e(){var a,c,i,r,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=(a=n).stage,console.log(a),V({campaignId:b.toString(),chainId:c.chain.id.toString(),stageId:c.id.toString(),userId:h.uid,taskId:a.id.toString()}),i=c.json_schema?JSON.parse(c.json_schema):{},r=c.ui_schema?JSON.parse(c.ui_schema):{},!a.displayed_prev_tasks){e.next=10;break}e.t0=a.displayed_prev_tasks,e.next=13;break;case 10:return e.next=12,fe(t);case 12:e.t0=e.sent;case 13:s=e.t0,l=s.map((function(e){return{responses:e.responses,json_schema:e.stage.json_schema?JSON.parse(e.stage.json_schema):{},ui_schema:e.stage.ui_schema?JSON.parse(e.stage.ui_schema):{}}})),console.log("previousTasks",l),G(l),D(a.responses),x(i),I(r),P(a.complete),ce(c.allow_release),ee(!0);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[n,h]);return Object(L.jsx)(k.a,{container:!0,children:Object(L.jsxs)(k.a,{direction:"row",container:!0,spacing:1,children:[(null===U||void 0===U?void 0:U.length)>0&&Object(L.jsx)(k.a,{container:!0,item:!0,sm:6,xs:12,sx:{display:"block"},children:U.map((function(e,t){var n,a,c;return Object(L.jsx)(j.a,{schema:null!==(n=e.json_schema)&&void 0!==n?n:{},uiSchema:null!==(a=e.ui_schema)&&void 0!==a?a:{},formData:null!==(c=e.responses)&&void 0!==c?c:{},widgets:ie,disabled:!0,children:" "},"prev_task_".concat(t))}))}),Object(L.jsx)(k.a,{container:!0,item:!0,sm:(null===U||void 0===U?void 0:U.length)>0?6:12,xs:12,sx:{display:"block"},children:Object(L.jsx)(j.a,{schema:null!==g&&void 0!==g?g:{},uiSchema:null!==w&&void 0!==w?w:{},formData:null!==N&&void 0!==N?N:{},formContext:M,liveOmit:!0,omitExtraData:!0,widgets:ie,disabled:J||!c,onChange:function(e){D(e.formData);var n={responses:e.formData};m.patch(f+t+"/",n)},onSubmit:function(){Y(!0);var e={responses:N,complete:!0};m.patch(f+t+"/",e).then((function(){return Y(!1)})).then((function(){return r&&r()})).catch((function(e){alert(e),Y(!1)}))},children:i?Object(L.jsx)(_.a,{display:"flex",children:J?Object(L.jsx)(v.a,{onClick:function(){m.get(f+t+"/uncomplete/").then((function(e){return r&&r()}))},disabled:!J||!c,children:"Return"}):Object(L.jsx)(v.a,{type:"submit",disabled:J||!$||!c,children:"Submit"})}):Object(L.jsxs)(_.a,{display:"flex",children:[Object(L.jsx)(v.a,{type:"submit",style:{marginRight:"8px"},disabled:J||!c||!$,children:"Submit"}),ae&&Object(L.jsx)(v.a,{variant:"danger",disabled:J||!c||!$,style:{margin:"0 8px"},onClick:function(){m.post(f+t+"/release_assignment/").then((function(){return s(!1)})).then((function(){return r&&r()})).catch((function(e){return alert(e)}))},children:"Release"}),X&&Object(L.jsx)(_.a,{paddingLeft:2,children:Object(L.jsx)(y.a,{})})]})})})]})})},ft=n(592),gt=n(303),xt=n.n(gt),mt=n(302),vt=n.n(mt),St=["expand"],kt=Object(ve.a)((function(e){e.expand;var t=Object(it.a)(e,St);return Object(L.jsx)(Te.a,Object(z.a)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),_t=function(e){var t=e.id,n=e.name,c=e.creatable,i=e.task,r=e.expand,s=e.refreshTasks,o=e.integrated,l=(e.handleAction,e.excluded),j=Object(a.useState)(!1),d=Object(u.a)(j,2),b=d[0],h=d[1],O=Object(a.useState)(null!==o&&void 0!==o&&o),p=Object(u.a)(O,2),f=p[0],g=p[1];Object(a.useEffect)((function(){h(r)}),[r]);var x=function(){be(t).then((function(e){return g(!0)})).catch((function(e){alert(e),s&&s()}))};return Object(L.jsxs)(et.a,{children:[Object(L.jsx)(dt.a,{action:Object(L.jsxs)(ft.a,{direction:"row",spacing:1,children:[o?i.complete?Object(L.jsx)(_.a,{m:1,children:Object(L.jsx)(vt.a,{color:"primary"})}):void 0:Object(L.jsx)(ee.a,{size:"small",variant:f?"text":"outlined",disabled:f,sx:{borderRadius:"5em"},onClick:x,children:f?Object(L.jsx)(xt.a,{color:"primary"}):"Get"}),Object(L.jsx)(kt,{expand:b,onClick:function(){h(!b)},disabled:c,"aria-expanded":b,"aria-label":"show more",children:Object(L.jsx)(Ot.a,{})})]}),sx:{py:1,px:2,background:i.complete?"lightgrey":""},title:n,subheader:"ID: ".concat(t),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}}),Object(L.jsx)(bt.a,{in:b,timeout:"auto",unmountOnExit:!0,children:Object(L.jsx)(nt.a,{children:Object(L.jsx)(pt,{id:t,taskData:i,integrated:o,handleAssignment:function(e){g(e)},isAssigned:o?!l:f,refreshTasks:s})})})]})},yt=function(e){var t=e.complete,n=e.selectable,c=e.tasks,i=e.creatable,r=e.refreshTasks,s=Object(a.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1];return Object(L.jsxs)(k.a,{container:!0,direction:i?"row":"column",alignItems:"center",justifyContent:i?"flex-start":"center",children:[n&&Object(L.jsx)(ee.a,{variant:"contained",onClick:function(){j(!l)},children:l?"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0432\u0441\u0435":"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0432\u0441\u0435"}),c.map((function(e){if(i){var a=e.id,c=e.name,s=e.description;return Object(L.jsx)(k.a,{item:!0,sx:{p:1},children:Object(L.jsx)(jt,{id:a,name:c,description:s,complete:t,selectable:n,creatable:i,integrated:!1})},e.id)}var o=e.id.toString(),u=e.stage.name,j=e.stage.description,d=!!e.integrator_group,b=e.reopened;return n?d?Object(L.jsx)(k.a,{item:!0,style:{padding:10},children:Object(L.jsx)(jt,{id:o,name:u,description:j,complete:t,selectable:n,creatable:i,integrated:d})},e.id):Object(L.jsx)(k.a,{item:!0,sx:{p:1,width:"100%"},children:Object(L.jsx)(_t,{id:o,name:u,description:j,complete:t,selectable:n,creatable:i,task:e,expand:l,refreshTasks:r})},e.id):Object(L.jsx)(k.a,{item:!0,style:{padding:10},children:Object(L.jsx)(jt,{id:o,name:u,description:j,complete:t,selectable:n,creatable:i,integrated:d,reopened:b})},e.id)}))]})},Ct=n(596),wt=n(593),It=function(e){var t=e.importance,n=e.onlyNew,i=Object(a.useState)([]),r=Object(u.a)(i,2),s=r[0],o=r[1],l=Object(a.useState)([]),j=Object(u.a)(l,2),b=j[0],h=j[1],O=Object(a.useState)(0),p=Object(u.a)(O,2),f=p[0],g=p[1],x=c.a.useState(1),m=Object(u.a)(x,2),v=m[0],y=m[1],C=Object(a.useState)(0),w=Object(u.a)(C,2),I=w[0],T=w[1],E=Object(wt.a)("(min-width:600px)"),N=Object(d.g)(),D=Object(d.h)().campaignId;Object(a.useEffect)((function(){0===I?xe(D,!1,t).then((function(e){return oe(e,h,g)})):1===I&&xe(D,!0,t).then((function(e){return oe(e,o,g)})),y(1)}),[I]);var A=function(e){N.push("notifications/".concat(e))};return n?Object(L.jsx)("div",{children:b.map((function(e){return Object(L.jsx)(k.a,{container:!0,justifyContent:"center",p:1,children:Object(L.jsx)(et.a,{onClick:function(){return A(e.id)},sx:{width:E?700:300,background:"lightblue",cursor:"pointer"},children:Object(L.jsxs)(nt.a,{children:[Object(L.jsx)(S.a,{variant:"h6",children:e.title}),Object(L.jsx)(S.a,{variant:"body2",component:"p",children:ue(e.created_at)})]})})},e.id)}))}):Object(L.jsxs)("div",{children:[Object(L.jsx)(S.a,{align:"center",variant:"h5",p:2,children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"}),Object(L.jsxs)(_.a,{sx:{width:"100%",bgcolor:"background.paper"},children:[Object(L.jsxs)(ot.a,{value:I,onChange:function(e,t){T(t)},centered:!0,variant:"fullWidth",children:[Object(L.jsx)(lt.a,Object(z.a)({label:"\u041d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435"},de(0))),Object(L.jsx)(lt.a,Object(z.a)({label:"\u041f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435"},de(1)))]}),Object(L.jsx)(st,{value:I,index:0,children:b.map((function(e){return Object(L.jsx)(k.a,{container:!0,justifyContent:"center",p:1,children:Object(L.jsx)(et.a,{onClick:function(){return A(e.id)},sx:{width:E?700:300,background:"lightblue",cursor:"pointer"},children:Object(L.jsxs)(nt.a,{children:[Object(L.jsx)(S.a,{variant:"h6",children:e.title}),Object(L.jsx)(S.a,{variant:"body2",component:"p",children:ue(e.created_at)})]})})},e.id)}))}),Object(L.jsx)(st,{value:I,index:1,children:s.map((function(e){return Object(L.jsx)(k.a,{container:!0,justifyContent:"center",p:1,children:Object(L.jsx)(et.a,{onClick:function(){return A(e.id)},sx:{width:E?700:300,background:"lightblue",cursor:"pointer"},children:Object(L.jsxs)(nt.a,{children:[Object(L.jsx)(S.a,{variant:"h6",children:e.title}),Object(L.jsx)(S.a,{variant:"body2",component:"p",children:ue(e.created_at)})]})})},e.id)}))})]}),f>1&&Object(L.jsx)(_.a,{p:2,display:"flex",justifyContent:"center",children:Object(L.jsx)(Ct.a,{count:f,page:v,onChange:function(e,n){y(n),console.log(I),n&&(0===I?xe(D,!1,t,n).then((function(e){return oe(e,h,g)})):1===I&&xe(D,!0,t,n).then((function(e){return oe(e,o,g)})))},showFirstButton:!0,showLastButton:!0})})]})},Tt=n(623),Et=n(600),Nt=n(626),Dt=n(601),Lt=n(594),At=n(627),Bt=function(e){var t=e.campaign,n=e.onFilter,c=Object(a.useState)(""),i=Object(u.a)(c,2),r=i[0],s=i[1],o=Object(a.useState)(""),l=Object(u.a)(o,2),j=l[0],d=l[1],b=Object(a.useState)(""),h=Object(u.a)(b,2),O=h[0],f=h[1],g=Object(a.useState)([]),x=Object(u.a)(g,2),v=x[0],S=x[1],k=Object(a.useState)([]),y=Object(u.a)(k,2),C=y[0],w=y[1],I=Object(a.useState)({}),T=Object(u.a)(I,2),E=(T[0],T[1]),N=Object(a.useState)({}),D=Object(u.a)(N,2),A=(D[0],D[1]),B=Object(a.useState)({}),F=Object(u.a)(B,2),J=(F[0],F[1]),P=Object(a.useState)(""),R=Object(u.a)(P,2),z=R[0],U=R[1];Object(a.useEffect)((function(){m.get("".concat("api/v1/chains/","?campaign=").concat(t,"&limit=100")).then((function(e){return e.data})).then((function(e){return S(e.results)})).then((function(){if(!r){var e=localStorage.getItem("selectable_filter_chain");e&&s(e)}}))}),[t]),Object(a.useEffect)((function(){r&&v.length>0&&m.get("".concat(p,"?chain=").concat(r,"&chain__campaign=").concat(t,"&limit=100")).then((function(e){return e.data})).then((function(e){return w(e.results)})).then((function(){if(!z){var e=localStorage.getItem("selectable_filter_search");e&&U(e)}if(!O){var t=localStorage.getItem("selectable_filter_stage"),n=localStorage.getItem("selectable_filter_form_stage");t&&d(t),n&&f(n)}}))}),[r]),Object(a.useEffect)((function(){if(console.log(O),O&&C.length>0){var e=C.filter((function(e){return e.id==O}))[0];if(console.log(e),e){var t=e.json_schema?JSON.parse(e.json_schema):{},n=e.ui_schema?JSON.parse(e.ui_schema):{};E(t),A(n);var a=localStorage.getItem("selectable_filter_responses");a&&J(JSON.parse(a))}}}),[O]);return Object(L.jsxs)(Tt.a,{children:[Object(L.jsx)(_.a,{sx:{m:1,minWidth:120},children:Object(L.jsx)(Et.a,{id:"outlined-basic",label:"Search Field",variant:"outlined",fullWidth:!0,onChange:function(e){localStorage.setItem("selectable_filter_search",e.target.value),U(e.target.value)}})}),v.length>0&&Object(L.jsxs)(Nt.a,{sx:{m:1,minWidth:120},children:[Object(L.jsx)(Dt.a,{id:"select-chain-filter",children:"Chain"}),Object(L.jsxs)(Lt.a,{labelId:"select-chain-label",id:"select-chain",value:r,label:"Chain",onChange:function(e){s(e.target.value),d(""),f(""),J({}),E({}),A({}),localStorage.setItem("selectable_filter_chain",e.target.value),localStorage.setItem("selectable_filter_stage",""),localStorage.setItem("selectable_filter_form_stage",""),localStorage.setItem("selectable_filter_responses",JSON.stringify({}))},children:[Object(L.jsx)(At.a,{value:"",children:Object(L.jsx)("em",{children:"None"})}),v.map((function(e){return Object(L.jsx)(At.a,{value:e.id,children:e.name},"filter_chain_".concat(e.id))}))]})]}),r&&Object(L.jsxs)(Nt.a,{disabled:""===r,sx:{m:1,minWidth:120},children:[Object(L.jsx)(Dt.a,{id:"select-stage-filter",children:"Stage"}),Object(L.jsxs)(Lt.a,{labelId:"select-stage-label",id:"select-stage",value:j,label:"Stage",onChange:function(e){d(e.target.value),localStorage.setItem("selectable_filter_stage",e.target.value)},children:[Object(L.jsx)(At.a,{value:"",children:Object(L.jsx)("em",{children:"None"})}),C.map((function(e){return Object(L.jsx)(At.a,{value:e.id,children:e.name},"filter_stage_".concat(e.id))}))]})]}),Object(L.jsx)(_.a,{sx:{m:1,minWidth:120}}),Object(L.jsx)(ee.a,{sx:{mx:1,mb:2},variant:"contained",onClick:function(){n(z,j)},children:"Search"})]})},Ft=function(e){var t=Object(d.h)().campaignId,n=Object(a.useContext)(A).currentUser,i=Object(a.useState)(0),r=Object(u.a)(i,2),s=r[0],o=r[1],l=Object(a.useState)([]),j=Object(u.a)(l,2),b=j[0],h=j[1],O=Object(a.useState)([]),f=Object(u.a)(O,2),g=f[0],x=f[1],v=Object(a.useState)([]),S=Object(u.a)(v,2),y=S[0],C=S[1],w=Object(a.useState)([]),I=Object(u.a)(w,2),T=I[0],E=I[1],N=Object(a.useState)(0),D=Object(u.a)(N,2),B=D[0],F=D[1],J=c.a.useState(1),P=Object(u.a)(J,2),R=P[0],z=P[1],U=Object(a.useState)(null),G=Object(u.a)(U,2),W=G[0],q=G[1],M=function(){he(t,1,W).then((function(e){return oe(e,h,F)})),Oe(t).then((function(e){return x(e)})),pe(t).then((function(e){return C(e)})),function(e){return m.get("".concat(p,"user_relevant/?chain__campaign=").concat(e)).then((function(e){return e.data}))}(t).then((function(e){return E(e)}))};return Object(a.useEffect)((function(){M()}),[t]),n&&n.uid&&Object(L.jsxs)(k.a,{children:[Object(L.jsx)(It,{importance:0,onlyNew:!0}),Object(L.jsx)(yt,{creatable:!0,tasks:T}),Object(L.jsxs)(ut,{value:s,handleChange:function(e,t){o(t),q(null),M()},showSelectable:b.length>0,children:[Object(L.jsx)(st,{value:s,index:0,children:Object(L.jsx)(yt,{complete:!1,tasks:y})}),Object(L.jsx)(st,{value:s,index:1,children:Object(L.jsx)(yt,{complete:!0,tasks:g})}),b.length>0&&Object(L.jsxs)(st,{value:s,index:2,children:[Object(L.jsx)(_.a,{pb:2,children:Object(L.jsx)(Bt,{campaign:t,onFilter:function(e,n){console.log(e,n);var a=e||n?{query:e,stage:n}:null;he(t,1,a).then((function(e){e.count>0?(q(a),z(1),oe(e,h,F)):(q(null),alert("\u041d\u0435\u0442 \u043f\u043e\u0445\u043e\u0436\u0438\u0445 \u0442\u0430\u0441\u043a\u043e\u0432"))}))}})}),Object(L.jsx)(yt,{selectable:!0,tasks:b,refreshTasks:M}),Object(L.jsx)(_.a,{pb:2,display:"flex",justifyContent:"center",children:Object(L.jsx)(Ct.a,{count:B,page:R,onChange:function(e,n){z(n),n&&(0===s?pe(t).then((function(e){return C(e)})):1===s?Oe(t).then((function(e){return x(e)})):2===s&&he(t,n,W).then((function(e){return oe(e,h,F)})))},showFirstButton:!0,showLastButton:!0})})]})]})]})},Jt=function(){var e=Object(d.h)().id,t=Object(d.g)(),n=Object(a.useState)(""),c=Object(u.a)(n,2),i=c[0],r=c[1],s=Object(a.useState)(""),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(a.useState)(""),h=Object(u.a)(b,2),p=h[0],f=h[1];Object(a.useEffect)((function(){console.log(O,e),function(e){return m.get(O+e+"/").then((function(e){return e.data}))}(e).then((function(e){var t=e.richText,n=e.name,a=e.description;n&&r(n),a&&j(a),t&&f(t)}))}),[e]);return Object(L.jsxs)("div",{style:{width:"70%",minWidth:"400px",margin:"0 auto",display:"block",padding:10},children:[Object(L.jsx)(S.a,{variant:"h3",align:"center",children:i}),Object(L.jsx)(S.a,{variant:"h6",align:"center",children:l}),p&&Object(L.jsx)(J,{data:p}),Object(L.jsx)(k.a,{container:!0,justifyContent:"center",style:{padding:20},children:Object(L.jsx)(ee.a,{variant:"contained",color:"primary",onClick:function(){(function(e){return m.post(O+e+"/join_campaign/")})(e).then((function(){return t.push("/campaign/".concat(e,"/tasks"))}))},children:"\u041f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f / \u041a\u043e\u0448\u0443\u043b\u0443\u0443"})})]})},Pt=function(){var e=Object(d.h)().id,t=Object(a.useState)({}),n=Object(u.a)(t,2),c=n[0],i=n[1];return Object(a.useEffect)((function(){(function(e){return m.get("".concat(g+e,"/")).then((function(e){return e.data}))})(e).then((function(e){return i(e)}))}),[e]),console.log(c),Object(L.jsxs)(k.a,{container:!0,justifyContent:"center",children:[Object(L.jsx)(k.a,{item:!0,xs:12,p:1,children:Object(L.jsx)(S.a,{align:"center",variant:"h6",children:c.title})}),Object(L.jsx)(k.a,{item:!0,xs:12,children:Object(L.jsx)(J,{data:c.text})})]})},Rt=n(607),zt=n(305),Ut=n.n(zt),Gt=function(){var e=Object(d.h)(),t=e.id,n=e.campaignId,i=Object(d.g)(),r=Object(a.useContext)(A).currentUser,s="/campaign/".concat(n,"/tasks"),b=Object(a.useState)({}),h=Object(u.a)(b,2),O=h[0],p=h[1],g=Object(a.useState)({}),x=Object(u.a)(g,2),S=x[0],C=x[1],w=Object(a.useState)({}),I=Object(u.a)(w,2),T=I[0],E=I[1],N=Object(a.useState)(!1),D=Object(u.a)(N,2),B=D[0],F=D[1],J=Object(a.useState)(!1),R=Object(u.a)(J,2),z=R[0],U=R[1],G=Object(a.useState)([]),W=Object(u.a)(G,2),q=W[0],M=W[1],V=Object(a.useState)(null),H=Object(u.a)(V,2),K=(H[0],H[1]),X=Object(a.useState)([]),Y=Object(u.a)(X,2),Q=Y[0],Z=Y[1],$=Object(a.useState)(!1),ee=Object(u.a)($,2),te=ee[0],ne=ee[1],ae=Object(a.useState)(!1),ce=Object(u.a)(ae,2),ie=ce[0],re=ce[1],oe=Object(a.useState)(!1),le=Object(u.a)(oe,2),ue=le[0],je=le[1],de=c.a.useState(!1),be=Object(u.a)(de,2),he=(be[0],be[1]),Oe=Object(a.useState)(""),pe=Object(u.a)(Oe,2),fe=(pe[0],pe[1],se),xe=function(){var e=Object(l.a)(o.a.mark((function e(){var n,a,c,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge(t);case 2:n=e.sent,a=n.stage,console.log("TASK",n),c=a.json_schema?JSON.parse(a.json_schema):{},i=a.ui_schema?JSON.parse(a.ui_schema):{},E(n.responses),p(c),C(i),F(n.complete),re(a.allow_go_back),je(a.allow_release),ne(!0);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=function(){m.get("".concat(f+t,"/get_integrated_tasks/")).then((function(e){return M(e.data)}))};Object(a.useEffect)((function(){t&&r&&(me(),xe())}),[t,r]),console.log("INTEGRATED LIST",q);var ve=function(e,t){K(e),t?Se(e):he(!0)},Se=function(e){if(null!==e){var t=Object(P.a)(Q),n=t.indexOf(e);n>-1&&t.splice(n,1);var a=Array.from(new Set(t));Z(a)}};return Object(L.jsxs)(k.a,{m:2,children:[q.map((function(e){return Object(L.jsx)(k.a,{py:1,children:Object(L.jsx)(_t,{integrated:!0,excluded:Q.includes(e.id),task:e,expand:!1,id:e.id,name:e.name,handleAction:ve,refreshTasks:me})},e.id)})),Object(L.jsx)(Ie.a,{sx:{py:1},children:Object(L.jsx)(Rt.a,{icon:Object(L.jsx)(Ut.a,{}),label:"\u041e\u0431\u043e\u0431\u0449\u0430\u044e\u0449\u0430\u044f \u0444\u043e\u0440\u043c\u0430"})}),Object(L.jsx)(v.a,{onClick:function(){m.get("".concat(f+t,"/trigger_webhook/")).then((function(e){return xe()}))},children:"\u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0444\u043e\u0440\u043c\u0443"}),Object(L.jsx)(k.a,{py:1,children:Object(L.jsx)(j.a,{schema:null!==O&&void 0!==O?O:{},uiSchema:null!==S&&void 0!==S?S:{},formData:null!==T&&void 0!==T?T:{},liveOmit:!0,omitExtraData:!0,widgets:fe,disabled:B,onChange:function(e){E(e.formData);var n={responses:e.formData};m.patch(f+t+"/",n)},onSubmit:function(){U(!0);var e={responses:T,complete:!0};m.patch(f+t+"/",e).then((function(e){console.log(e),U(!1),e.data.next_direct_id?(p({}),C({}),E({}),i.push("".concat(s,"/").concat(e.data.next_direct_id))):i.push(s)}))},children:Object(L.jsxs)(_.a,{display:"flex",children:[Object(L.jsx)(v.a,{type:"submit",disabled:B||z||!te,children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),ie&&Object(L.jsx)(v.a,{style:{margin:"0 16px"},onClick:function(){m.get(f+t+"/open_previous/").then((function(e){p({}),C({}),E({}),i.push("".concat(s,"/").concat(e.data.id))}))},children:"\u041a \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u043c\u0443 \u0442\u0430\u0441\u043a\u0443"}),ue&&Object(L.jsx)(v.a,{variant:"danger",disabled:B||z||!te,style:{margin:"0 8px"},onClick:function(){m.post(f+t+"/release_assignment/").then((function(){return i.push(s)}))},children:"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"}),z&&Object(L.jsx)(_.a,{paddingLeft:2,children:Object(L.jsx)(y.a,{})})]})})})]})},Wt=function(){var e=Object(a.useContext)(A).currentUser;if(e){var t=localStorage.getItem("token");e.getIdToken(!1).then((function(e){t?e!==t&&(localStorage.setItem("token",e),window.location.reload()):(localStorage.setItem("token",e),window.location.reload())}))}return Object(L.jsx)("div",{children:Object(L.jsx)(Qe.a,{children:Object(L.jsxs)(d.d,{children:[Object(L.jsx)(d.b,{exact:!0,path:"/campaign/about/:id",children:Object(L.jsx)(Jt,{})}),Object(L.jsx)(d.b,{path:"/campaign/:campaignId",children:Object(L.jsxs)(Ye,{children:[Object(L.jsx)(d.b,{exact:!0,path:"/campaign/:campaignId/tasks",children:Object(L.jsx)(Ft,{})}),Object(L.jsx)(d.b,{exact:!0,path:"/campaign/:campaignId/tasks/:id",children:Object(L.jsx)(me,{})}),Object(L.jsx)(d.b,{exact:!0,path:"/campaign/:campaignId/tasks/:id/integrated",children:Object(L.jsx)(Gt,{})}),Object(L.jsx)(d.b,{exact:!0,path:"/campaign/:campaignId/notifications",children:Object(L.jsx)(It,{})}),Object(L.jsx)(d.b,{exact:!0,path:"/campaign/:campaignId/notifications/:id",children:Object(L.jsx)(Pt,{})})]})}),Object(L.jsx)(d.b,{path:"/",children:Object(L.jsx)($e,{children:Object(L.jsx)(ct,{})})})]})})})},qt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,628)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),i(e),r(e)}))};r.a.render(Object(L.jsx)(B,{children:Object(L.jsx)(Wt,{})}),document.getElementById("root")),qt()}},[[539,1,2]]]);
//# sourceMappingURL=main.57b15279.chunk.js.map