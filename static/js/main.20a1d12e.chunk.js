(this["webpackJsonpgigaturnip-taskview"]=this["webpackJsonpgigaturnip-taskview"]||[]).push([[0],{290:function(e,t,n){},498:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(67),i=n.n(r),s=(n(290),n(41)),o=n.n(s),l=n(58),u=n(8),j=n(83),d=n(28),b=n(122),h=n.n(b),p="api/v1/campaigns/",O="api/v1/taskstages/",f="api/v1/tasks/",g=h.a.create({baseURL:"https://journal-bb5e3.uc.r.appspot.com/"});g.interceptors.request.use((function(e){var t=localStorage.getItem("token");return t&&(e.headers.Authorization="JWT "+t),e}),(function(e){return Promise.reject(e)}));var x=g,m=(n(254),n(23)),v=n(6),k=n(22),S=n(75);S.a.initializeApp({apiKey:"AIzaSyCXiwOUNsbzKH7sbSAZrqA9f7VOeCMdUOQ",authDomain:"gigaturnip-b6b5b.firebaseapp.com",projectId:"gigaturnip-b6b5b",storageBucket:"gigaturnip-b6b5b.appspot.com",messagingSenderId:"414429242328",appId:"1:414429242328:web:a4685f5ac6895ea767c8ad",measurementId:"G-Y8JTEJMTET"});var y=new S.a.auth.GoogleAuthProvider;S.a.firestore().settings({ignoreUndefinedProperties:!0});var C=function(){return y.setCustomParameters({prompt:"select_account"}),S.a.auth().signInWithPopup(y)},w=function(){return S.a.auth().signOut().then((function(){return localStorage.removeItem("token")})).then((function(){return window.location.reload()}))},_=S.a,I=function(e,t,n){return n&&e?Object(k.a)(Object(k.a)({},e),t):t},T=function(){var e=Object(l.a)(o.a.mark((function e(t,n,a,c,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return r||(a({}),c({})),e.next=4,Promise.all(t.map(function(){var e=Object(l.a)(o.a.mark((function e(t){var i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.name.replace(/\./g,"_").replace(/ /g,"_"),console.log(i),s=n.child(i).put(t),a((function(e){var t=Object(v.a)({},i,{status:"loading",progress:0});return e?Object(k.a)(Object(k.a)({},e),t):t})),s.on(_.storage.TaskEvent.STATE_CHANGED,(function(e){var t=e.bytesTransferred/e.totalBytes*100;a((function(e){var n=Object(v.a)({},i,{status:"loading",progress:t});return e?Object(k.a)(Object(k.a)({},e),n):n}))}),(function(e){console.log(e)}),(function(){s.snapshot.ref.getDownloadURL().then((function(e){console.log("FILE PATH",s.snapshot.ref.fullPath);var t=s.snapshot.ref.fullPath,n=e;a((function(e){var t=Object(v.a)({},i,{status:"complete",progress:100,url:n});return I(e,t,r)})),c((function(e){var n=Object(v.a)({},i,t);return I(e,n,r)}))}))}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,c,r){return e.apply(this,arguments)}}(),E=n(547),D=n(552),N=n(548),L=n(3),J=function(e){return Object(L.jsxs)(E.a,{display:"flex",alignItems:"center",children:[Object(L.jsx)(E.a,{width:"100%",mr:1,children:Object(L.jsx)(D.a,Object(k.a)({variant:"determinate"},e))}),Object(L.jsx)(E.a,{minWidth:35,children:Object(L.jsx)(N.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},F=n(269),P=n(544),B=function(e){var t=e.schema,n=e.uiSchema,c=e.disabled,r=e.required,i=e.formContext,s=e.value,j=i.campaignId,d=i.chainId,b=i.stageId,h=i.userId,p=i.taskId,O=Object(a.useState)({}),f=Object(u.a)(O,2),g=f[0],x=f[1],S=Object(a.useState)({}),y=Object(u.a)(S,2),C=y[0],w=y[1],I=Object(a.useState)(""),E=Object(u.a)(I,2),D=E[0],N=E[1],B=Object(a.useState)(!1),z=Object(u.a)(B,2),A=z[0],G=z[1],U=Object(a.useState)(!1),W=Object(u.a)(U,2),q=W[0],M=W[1],R=Object(a.useState)(""),V=Object(u.a)(R,2),H=V[0],K=V[1],X=Object(a.useState)({}),Y=Object(u.a)(X,2),Q=Y[0],Z=Y[1],$=!(!n["ui:options"]||!n["ui:options"].private)&&n["ui:options"].private,ee=!(!n["ui:options"]||!n["ui:options"].multiple)&&n["ui:options"].multiple,te=Object.keys(g).length>0,ne=r&&!te,ae=void 0;j&&d&&b&&h&&p&&(ae=_.storage(),ae=(ae=$?ae.ref("private"):ae.ref("public")).child(j).child(d).child(b).child(h).child(p)),Object(a.useEffect)((function(){if(s&&Object.keys(s).length>0){console.log("value",s);var e=JSON.parse(s);Z(e),Object.keys(e).forEach((function(t){re(e[t]).then((function(e){return x((function(n){return Object(k.a)(Object(k.a)({},n),{},Object(v.a)({},t,{url:e,status:"complete"}))}))}))}))}}),[s]);var ce=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Files selected: ",Object(m.a)(t.target.files)),T(Object(m.a)(t.target.files),ae,x,w,ee),t.target.value=null;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(e){return _.storage().ref(e).getDownloadURL()};Object(a.useEffect)((function(){if(C&&Object.keys(C).length>0){console.log("fileLinks",C);try{var t="";if(ee){var n=JSON.parse(s),a=Object(k.a)(Object(k.a)({},n),C);t=JSON.stringify(a)}else t=JSON.stringify(C);e.onChange(t)}catch(r){var c=JSON.stringify(C);console.error(r),e.onChange(c)}}}),[C]);var ie=function(){var e=Object(l.a)(o.a.mark((function e(t){var n,a,c,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Q,console.log("FILE CLICK VALUE",n),!(t in n)){e.next=22;break}return a=n[t],console.log(a),e.next=7,_.storage().ref().child(a).getMetadata();case 7:c=e.sent,r=c.contentType.split("/")[0],console.log("FILE TYPE",r),e.t0=r,e.next="image"===e.t0?13:"video"===e.t0?17:21;break;case 13:return N(g[t].url),K(c.contentType),G(!0),e.abrupt("break",22);case 17:return N(g[t].url),K(c.contentType),M(!0),e.abrupt("break",22);case 21:alert("\u0424\u0430\u0439\u043b \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0444\u043e\u0442\u043e \u0438\u043b\u0438 \u0432\u0438\u0434\u0435\u043e");case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function(){N(""),K(""),G(!1),M(!1)};return Object(L.jsxs)("div",{children:[A&&Object(L.jsx)(F.a,{src:[D],disableScroll:!1,backgroundStyle:{backgroundColor:"rgba(0,0,0,0.8)"},closeOnClickOutside:!0,onClose:se}),Object(L.jsx)(P.a,{open:q,onClose:se,fullWidth:!0,children:Object(L.jsxs)("video",{height:"360px",controls:!0,children:[Object(L.jsx)("source",{src:D,type:H}),"Your browser does not support the video tag."]})}),Object(L.jsx)("label",{className:"form-label",children:null===t||void 0===t?void 0:t.title}),Object(L.jsx)("br",{}),Object(L.jsx)("input",{disabled:c,required:ne,multiple:ee,type:"file",onChange:ce}),Object.keys(g).map((function(t,n){return Object(L.jsxs)("div",{children:[Object(L.jsxs)("div",{style:{display:"flex",alignItems:"baseline"},children:[Object(L.jsx)("p",{children:t}),"complete"===g[t].status&&Object(L.jsxs)("div",{style:{display:"flex",alignItems:"baseline"},children:[Object(L.jsx)("button",{onClick:function(){return ie(t)},style:{fontSize:"14px",padding:0,margin:"0 10px"},type:"button",className:"btn btn-link text-success",children:"\u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0444\u0430\u0439\u043b"}),!c&&Object(L.jsx)("button",{onClick:function(){return function(t){var n=Q;if(t in n){delete n[t];var a=JSON.stringify(n);e.onChange(a)}var c=Object(k.a)({},C);t in c&&(delete c[t],w(c));var r=Object(k.a)({},g);t in r&&(delete r[t],x(r)),console.log("DELETE LOG",r)}(t)},style:{fontSize:"14px",padding:0,margin:"0 10px"},type:"button",className:"btn btn-link text-danger",children:"\u0443\u0434\u0430\u043b\u0438\u0442\u044c"})]})]}),"loading"===g[t].status&&Object(L.jsx)(J,{value:g[t].progress})]},t)}))]})},z=n(131),A=n(546),G=n(554),U=c.a.createContext(),W=function(e){var t=e.children,n=Object(a.useState)(null),c=Object(u.a)(n,2),r=c[0],i=c[1];return Object(a.useEffect)((function(){_.auth().onAuthStateChanged((function(e){e&&(i(e),e.getIdToken(!0).then((function(e){localStorage.setItem("token",e)})))})),_.auth().onIdTokenChanged((function(e){e&&e.getIdToken(!1).then((function(e){localStorage.setItem("token",e)}))}))}),[]),Object(L.jsx)(U.Provider,{value:{currentUser:r},children:t})},q=n(274),M=function(e){var t=e.data;return Object(L.jsx)(q.a,{id:"ViewerTinyMCE",value:t,inline:!1,disabled:!0,tinymceScriptSrc:"/GigaTurnipTaskView/tinymce/tinymce.min.js",init:{plugins:"autoresize",toolbar:!1,menubar:!1,image_advtab:!0,importcss_append:!0}})},R=function(e,t,n){var a=e.results,c=e.count,r=Math.ceil(c/10);console.log("numOfPages",r),console.log("results",a),t(a),n(r)},V=function(e){return x.post(f+e+"/request_assignment/")},H=function(e,t){return console.log(t),t&&t>0?x.get("".concat(f,"user_selectable/?stage__chain__campaign=").concat(e,"&limit=10&offset=").concat(10*(t-1))).then((function(e){return e.data})):x.get("".concat(f,"user_selectable/?stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return console.log("getSelectableTasks",e),e}))},K=function(e){return x.get("".concat(f,"user_relevant/?complete=",!0,"&stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return console.log("getCompleteTasks",e),e}))},X=function(e){return x.get("".concat(f,"user_relevant/?complete=",!1,"&stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return console.log("getOpenTasks",e),e}))},Y=function(e){return x.get("".concat(f+e,"/list_displayed_previous/")).then((function(e){return e.data}))},Q=n(21),Z=function(e){var t,n,c,r=e.id,i=e.placeholder,s=e.required,o=e.readonly,l=e.disabled,j=e.label,d=e.value,b=e.onChange,p=e.onBlur,O=e.onFocus,f=e.autofocus,g=e.options,x=e.schema,m=e.rawErrors,v=void 0===m?[]:m;console.log("options",g);var k=null!==(t=g.searchField)&&void 0!==t?t:"search",S=null!==(n=g.responseField)&&void 0!==n?n:"text",y=null!==(c=null===g||void 0===g?void 0:g.params)&&void 0!==c?c:"",C=Object(a.useState)([]),w=Object(u.a)(C,2),_=w[0],I=w[1],T=function(){if(g.webhook){var e="".concat(g.webhook,"?").concat(k,"=").concat(d+y);h.a.get(e).then((function(e){return e.data})).then((function(e){return I(e)}))}},E="string"===x.type?"text":"".concat(x.type);return Object(L.jsxs)(Q.a.Group,{className:"mb-0",children:[Object(L.jsxs)(Q.a.Label,{className:v.length>0?"text-danger":"",children:[j||x.title,(j||x.title)&&s?"*":null]}),Object(L.jsx)(Q.a.Control,{id:r,placeholder:i,autoFocus:f,required:s,disabled:l,readOnly:o,className:v.length>0?"is-invalid":"",list:"examples_".concat(r),type:E,value:d||0===d?d:"",onChange:function(e){var t=e.target.value;return T(),b(""===t?g.emptyValue:t)},onBlur:function(e){var t=e.target.value;return p(r,t)},onFocus:function(e){var t=e.target.value;return O(r,t)}}),_?Object(L.jsx)("datalist",{id:"examples_".concat(r),children:_.map((function(e){return Object(L.jsx)("option",{value:e[S]},e[S])}))}):null]})},$=function(e){var t=e.id,n=e.schema,a=e.options,c=e.value,r=e.required,i=e.disabled,s=e.readonly,o=e.label,l=e.onChange,u=e.onBlur,j=e.onFocus,d=a.enumOptions,b=a.enumDisabled,h=function(e){var t=e.target.value;return l("boolean"==n.type?"false"!==t:t)},p=function(e){var n=e.target.value;return u(t,n)},O=function(e){var n=e.target.value;return j(t,n)},f=Boolean(a&&a.inline);return Object(L.jsxs)(Q.a.Group,{className:"mb-0",children:[Object(L.jsxs)(Q.a.Label,{className:"d-block",children:[o||n.title,(o||n.title)&&r?"*":null]}),d.map((function(e,n){var a=Array.isArray(b)&&-1!==b.indexOf(e.value),o=e.value==c;return Object(L.jsx)(Q.a.Check,{inline:f,label:e.label,id:"".concat(t,"_").concat(e.label),name:t,type:"radio",disabled:i||a||s,checked:o,required:r,value:e.value,onChange:h,onBlur:p,onFocus:O},n)}))]})},ee=function(e){var t=Object(d.g)(),n=t.id,c=t.campaignId;!n&&e.id&&(n=e.id);var r=Object(d.f)(),i=Object(a.useContext)(U).currentUser,s="/campaign/".concat(c,"/tasks"),b=Object(a.useState)({}),h=Object(u.a)(b,2),p=h[0],O=h[1],g=Object(a.useState)({}),m=Object(u.a)(g,2),v=m[0],k=m[1],S=Object(a.useState)({}),y=Object(u.a)(S,2),C=y[0],w=y[1],_=Object(a.useState)(!1),I=Object(u.a)(_,2),T=I[0],D=I[1],N=Object(a.useState)([]),J=Object(u.a)(N,2),F=J[0],P=J[1],W=Object(a.useState)({}),q=Object(u.a)(W,2),R=q[0],V=q[1],H=Object(a.useState)(""),K=Object(u.a)(H,2),X=K[0],Q=K[1],ee=Object(a.useState)(!1),te=Object(u.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),re=Object(u.a)(ce,2),ie=re[0],se=re[1],oe={customfile:B,autocomplete:Z,RadioWidget:$};Object(a.useEffect)((function(){n&&i&&function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,r,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get(f+n+"/").then((function(e){return e.data}));case 2:return t=e.sent,(a=t.stage)&&a.rich_text&&Q(a.rich_text),V({campaignId:c.toString(),chainId:a.chain.id.toString(),stageId:a.id.toString(),userId:i.uid,taskId:t.id.toString()}),r=a.json_schema?JSON.parse(a.json_schema):{},s=a.ui_schema?JSON.parse(a.ui_schema):{},e.next=10,Y(n).then((function(e){return e.map((function(e){return{responses:e.responses,json_schema:JSON.parse(e.stage.json_schema),ui_schema:JSON.parse(e.stage.ui_schema)}}))}));case 10:l=e.sent,P(l),w(t.responses),O(r),k(s),D(t.complete),se(!0);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[n,i]);return Object(L.jsxs)("div",{style:{width:"70%",minWidth:"400px",margin:"0 auto",display:"block",padding:10},children:[""!==X&&Object(L.jsx)("div",{style:{paddingBottom:20},children:Object(L.jsx)(M,{data:X})}),F.length>0&&Object(L.jsx)(A.a,{children:F.map((function(e,t){var n,a,c;return Object(L.jsx)(j.a,{schema:null!==(n=e.json_schema)&&void 0!==n?n:{},uiSchema:null!==(a=e.ui_schema)&&void 0!==a?a:{},formData:null!==(c=e.responses)&&void 0!==c?c:{},widgets:oe,disabled:!0,children:" "},"prev_task_".concat(t))}))}),Object(L.jsx)(A.a,{children:Object(L.jsx)(j.a,{schema:p,uiSchema:v,formData:C,formContext:R,liveOmit:!0,omitExtraData:!0,widgets:oe,disabled:T,onChange:function(e){w(e.formData);var t={responses:e.formData};x.patch(f+n+"/",t)},onSubmit:function(){ae(!0);var e={responses:C,complete:!0};x.patch(f+n+"/",e).then((function(){return ae(!1)})).then((function(){return r.push(s)}))},children:Object(L.jsxs)(E.a,{display:"flex",children:[Object(L.jsx)(z.a,{type:"submit",disabled:T||ne||!ie,children:"Submit"}),ne&&Object(L.jsx)(E.a,{paddingLeft:2,children:Object(L.jsx)(G.a,{})})]})})})]})},te=n(7),ne=n(35),ae=n(543),ce=n(549),re=n(551),ie=n(550),se="GigaTurnip Tasks",oe=n(555),le=240,ue=function(e){return{width:le,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"}},je=function(e){return Object(v.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"calc(".concat(e.spacing(7)," + 1px)")},e.breakpoints.up("sm"),{width:"calc(".concat(e.spacing(9)," + 1px)")})},de=Object(te.a)("div")((function(e){var t=e.theme;return Object(k.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),be=Object(te.a)(ce.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(k.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:le,width:"calc(100% - ".concat(le,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),he=(Object(te.a)(ae.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(k.a)(Object(k.a)({width:le,flexShrink:0,whiteSpace:"nowrap",boxSizing:"border-box"},n&&Object(k.a)(Object(k.a)({},ue(t)),{},{"& .MuiDrawer-paper":ue(t)})),!n&&Object(k.a)(Object(k.a)({},je(t)),{},{"& .MuiDrawer-paper":je(t)}))})),function(e){Object(ne.a)();var t=Object(d.f)(),n=(Object(d.g)().campaignId,Object(a.useContext)(U).currentUser),c=e.children,r=Object(a.useState)(!1),i=Object(u.a)(r,2),s=i[0];i[1];return Object(L.jsxs)(E.a,{sx:{display:"flex"},children:[Object(L.jsx)(ie.a,{}),Object(L.jsx)(be,{position:"fixed",open:s,children:Object(L.jsxs)(re.a,{children:[Object(L.jsx)(N.a,{variant:"h6",noWrap:!0,component:"div",sx:{cursor:"pointer",flexGrow:1},onClick:function(){t.push("/")},children:se}),Object(L.jsx)(N.a,{children:null===n||void 0===n?void 0:n.email}),n?Object(L.jsx)(oe.a,{onClick:w,color:"inherit",children:"\u0412\u044b\u0439\u0442\u0438"}):Object(L.jsx)(oe.a,{onClick:C,color:"inherit",children:"\u0412\u043e\u0439\u0442\u0438"})]})}),Object(L.jsxs)(E.a,{component:"main",sx:{flexGrow:1,p:0},children:[Object(L.jsx)(de,{}),c]})]})}),pe=n(57),Oe=Object(te.a)("div")((function(e){var t=e.theme;return Object(k.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),fe=function(e){var t=e.children,n=Object(a.useContext)(U).currentUser;Object(d.f)();return Object(L.jsxs)(E.a,{sx:{flexGrow:1},children:[Object(L.jsx)(ce.a,{position:"static",children:Object(L.jsxs)(re.a,{children:[Object(L.jsx)(N.a,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:se}),Object(L.jsx)(N.a,{children:null===n||void 0===n?void 0:n.email}),n?Object(L.jsx)(oe.a,{onClick:w,color:"inherit",children:"\u0412\u044b\u0439\u0442\u0438"}):Object(L.jsx)(oe.a,{onClick:C,color:"inherit",children:"\u0412\u043e\u0439\u0442\u0438"})]})}),Object(L.jsxs)(E.a,{component:"main",sx:{flexGrow:1,p:3},children:[Object(L.jsx)(Oe,{}),t]})]})},ge=n(556),xe=n(558),me=n(557),ve=function(e){var t=e.data,n=t.id,a=t.name,c=t.description,r=t.campaign,i=e.onCardButtonClick,s=e.openCampaignInfo,o=e.selectable;return Object(L.jsxs)(ge.a,{sx:{width:300},children:[Object(L.jsxs)(me.a,{children:[Object(L.jsx)(N.a,{variant:"h5",component:"h2",gutterBottom:!0,children:a}),Object(L.jsxs)(N.a,{variant:"subtitle2",color:"textSecondary",children:["ID: ",n," ",r&&"Campaign: ".concat(r)]}),Object(L.jsx)(N.a,{variant:"body1",component:"p",children:c||Object(L.jsx)("br",{})})]}),Object(L.jsx)(xe.a,{children:o?Object(L.jsx)(oe.a,{size:"small",onClick:function(){s&&s(n)},children:"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435"}):Object(L.jsx)(oe.a,{size:"small",onClick:function(){i(n)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},ke=function(){var e=Object(a.useState)([]),t=Object(u.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)([]),i=Object(u.a)(r,2),s=i[0],o=i[1],l=Object(d.f)();Object(a.useEffect)((function(){x.get(p+"list_user_campaigns/").then((function(e){return e.data})).then((function(e){return console.log("user_campaigns",e),e})).then((function(e){return c(e)})),x.get(p+"list_user_selectable/").then((function(e){return e.data})).then((function(e){return console.log("selectable_campaigns",e),e})).then((function(e){return o(e)}))}),[]);var j=function(e){l.push("/campaign/about/".concat(e))},b=function(e){l.push("/campaign/".concat(e,"/tasks"))};return Object(L.jsxs)(A.a,{children:[n&&n.length>0&&Object(L.jsxs)(A.a,{children:[Object(L.jsx)(N.a,{align:"center",variant:"h4",children:"\u041c\u043e\u0438 \u043a\u0430\u043c\u043f\u0430\u043d\u0438\u0438"}),Object(L.jsx)(A.a,{container:!0,justifyContent:"center",children:n.map((function(e){return Object(L.jsx)(A.a,{item:!0,style:{padding:10},children:Object(L.jsx)(ve,{data:e,onCardButtonClick:b,openCampaignInfo:j,selectable:!1})},e.id)}))})]}),s&&s.length>0&&Object(L.jsxs)(A.a,{children:[Object(L.jsx)(N.a,{align:"center",variant:"h4",children:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043a\u0430\u043c\u043f\u0430\u043d\u0438\u0438"}),Object(L.jsx)(A.a,{container:!0,justifyContent:"center",children:s.map((function(e){return Object(L.jsx)(A.a,{item:!0,style:{padding:10},children:Object(L.jsx)(ve,{data:e,onCardButtonClick:b,openCampaignInfo:j,selectable:!0})},e.id)}))})]})]})},Se=n(127),ye=["children","value","index"],Ce=function(e){var t=e.children,n=e.value,a=e.index,c=Object(Se.a)(e,ye);return Object(L.jsx)("div",Object(k.a)(Object(k.a)({role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},c),{},{children:n===a&&Object(L.jsx)(E.a,{children:t})}))},we=n(539),_e=n(559);function Ie(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}var Te=function(e){var t=e.value,n=e.handleChange;return Object(L.jsxs)(E.a,{sx:{width:"100%",bgcolor:"background.paper"},children:[Object(L.jsxs)(we.a,{value:t,onChange:n,centered:!0,variant:"fullWidth",children:[Object(L.jsx)(_e.a,Object(k.a)({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ie(0))),Object(L.jsx)(_e.a,Object(k.a)({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ie(1))),e.showSelectable&&Object(L.jsx)(_e.a,Object(k.a)({label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435"},Ie(2)))]}),e.children]})},Ee=function(e){var t=e.id,n=(e.complete,e.name),a=e.description,c=e.creatable,r=e.selectable,i=Object(d.f)(),s=function(){i.push("".concat(i.location.pathname,"/").concat(t))},o=function(){(function(e){return x.post(O+e+"/create_task/").then((function(e){return e.data}))})(t).then((function(e){return i.push("".concat(i.location.pathname,"/").concat(e.id))})).catch((function(e){return alert(e)}))},l=function(){V(t).then((function(e){return i.push("".concat(i.location.pathname,"/").concat(t))})).catch((function(e){return alert(e)}))};return Object(L.jsxs)(ge.a,{sx:{width:300},children:[Object(L.jsxs)(me.a,{children:[Object(L.jsx)(N.a,{variant:"h5",component:"span",gutterBottom:!0,children:n}),Object(L.jsx)("br",{}),Object(L.jsx)(N.a,{variant:"subtitle2",component:"span",children:t&&!c?"ID: ".concat(t):Object(L.jsx)("br",{})}),Object(L.jsx)("br",{}),Object(L.jsx)(N.a,{variant:"body1",component:"span",children:a||Object(L.jsx)("br",{})})]}),Object(L.jsx)(xe.a,{children:r?Object(L.jsx)(oe.a,{size:"small",onClick:l,children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"}):c?Object(L.jsx)(oe.a,{size:"small",onClick:o,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}):Object(L.jsx)(oe.a,{size:"small",onClick:s,children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},De=n(561),Ne=n(562),Le=n(560),Je=n(272),Fe=n.n(Je),Pe=function(e){var t=e.id,n=e.taskData,c=e.isAssigned,r=e.refreshTasks,i=Object(d.g)().campaignId,s=Object(a.useContext)(U).currentUser,b=Object(a.useState)({}),h=Object(u.a)(b,2),p=h[0],O=h[1],g=Object(a.useState)({}),m=Object(u.a)(g,2),v=m[0],k=m[1],S=Object(a.useState)({}),y=Object(u.a)(S,2),C=y[0],w=y[1],_=Object(a.useState)(!1),I=Object(u.a)(_,2),T=I[0],D=I[1],N=Object(a.useState)([]),J=Object(u.a)(N,2),F=J[0],P=J[1],W=Object(a.useState)({}),q=Object(u.a)(W,2),M=q[0],R=q[1],V=Object(a.useState)(!1),H=Object(u.a)(V,2),K=H[0],X=H[1],Y={customfile:B,autocomplete:Z,RadioWidget:$};Object(a.useEffect)((function(){n&&s&&function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,c,r,l,u,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(c=n).stage,R({campaignId:i.toString(),chainId:r.chain.id.toString(),stageId:r.id.toString(),userId:s.uid,taskId:c.id.toString()}),l=null!==(t=JSON.parse(r.json_schema))&&void 0!==t?t:{},u=null!==(a=JSON.parse(r.ui_schema))&&void 0!==a?a:{},j=c.displayed_prev_tasks.map((function(e){return{responses:e.responses,json_schema:JSON.parse(e.stage.json_schema),ui_schema:JSON.parse(e.stage.ui_schema)}})),P(j),w(c.responses),O(l),k(u),D(c.complete);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[n,s]);return Object(L.jsx)(A.a,{container:!0,children:Object(L.jsxs)(A.a,{direction:"row",container:!0,spacing:1,children:[F.length>0&&Object(L.jsx)(A.a,{container:!0,item:!0,sm:6,xs:12,sx:{display:"block"},children:F.map((function(e,t){var n,a,c;return Object(L.jsx)(j.a,{schema:null!==(n=e.json_schema)&&void 0!==n?n:{},uiSchema:null!==(a=e.ui_schema)&&void 0!==a?a:{},formData:null!==(c=e.responses)&&void 0!==c?c:{},widgets:Y,disabled:!0,children:" "},"prev_task_".concat(t))}))}),Object(L.jsx)(A.a,{container:!0,item:!0,sm:F.length>0?6:12,xs:12,sx:{display:"block"},children:Object(L.jsx)(j.a,{schema:null!==p&&void 0!==p?p:{},uiSchema:null!==v&&void 0!==v?v:{},formData:null!==C&&void 0!==C?C:{},formContext:M,liveOmit:!0,omitExtraData:!0,widgets:Y,disabled:T||!c,onChange:function(e){w(e.formData);var n={responses:e.formData};x.patch(f+t+"/",n)},onSubmit:function(){X(!0);var e={responses:C,complete:!0};x.patch(f+t+"/",e).then((function(){return X(!1)})).then((function(){return r&&r()})).catch((function(e){alert(e),X(!1)}))},children:Object(L.jsxs)(E.a,{display:"flex",children:[Object(L.jsx)(z.a,{type:"submit",disabled:T||!c,children:"Submit"}),K&&Object(L.jsx)(E.a,{paddingLeft:2,children:Object(L.jsx)(G.a,{})})]})})})]})})},Be=n(536),ze=n(271),Ae=n.n(ze),Ge=["expand"],Ue=Object(te.a)((function(e){e.expand;var t=Object(Se.a)(e,Ge);return Object(L.jsx)(Le.a,Object(k.a)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),We=function(e){var t=e.id,n=(e.complete,e.name),c=(e.description,e.creatable),r=(e.selectable,e.task),i=e.expand,s=e.refreshTasks,o=Object(a.useState)(!1),l=Object(u.a)(o,2),j=l[0],d=l[1],b=Object(a.useState)(!1),h=Object(u.a)(b,2),p=h[0],O=h[1];Object(a.useEffect)((function(){d(i)}),[i]);return Object(L.jsxs)(ge.a,{children:[Object(L.jsx)(De.a,{action:Object(L.jsxs)(Be.a,{direction:"row",spacing:1,children:[Object(L.jsx)(oe.a,{size:"small",variant:p?"text":"outlined",disabled:p,sx:{borderRadius:"5em"},onClick:function(){V(t).then((function(e){return O(!0)})).catch((function(e){alert(e),s&&s()}))},children:p?Object(L.jsx)(Ae.a,{color:"primary"}):"Get"}),Object(L.jsx)(Ue,{expand:j,onClick:function(){d(!j)},disabled:c,"aria-expanded":j,"aria-label":"show more",children:Object(L.jsx)(Fe.a,{})})]}),sx:{py:1,px:2},title:n,subheader:"ID: ".concat(t),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}}),Object(L.jsx)(Ne.a,{in:j,timeout:"auto",unmountOnExit:!0,children:Object(L.jsx)(me.a,{children:Object(L.jsx)(Pe,{id:t,taskData:r,isAssigned:p,refreshTasks:s})})})]})},qe=function(e){var t=e.complete,n=e.selectable,c=e.tasks,r=e.creatable,i=e.refreshTasks,s=Object(a.useState)(!1),o=Object(u.a)(s,2),l=o[0],j=o[1];return Object(L.jsxs)(A.a,{container:!0,direction:r?"row":"column",alignItems:"center",justifyContent:r?"flex-start":"center",children:[n&&Object(L.jsx)(oe.a,{variant:"contained",onClick:function(){j(!l)},children:l?"\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0432\u0441\u0435":"\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0432\u0441\u0435"}),c.map((function(e){if(r){var a=e.id,c=e.name,s=e.description;return Object(L.jsx)(A.a,{item:!0,sx:{p:1},children:Object(L.jsx)(Ee,{id:a,name:c,description:s,complete:t,selectable:n,creatable:r})},e.id)}var o=e.id.toString(),u=e.stage.name,j=e.stage.description;return n?Object(L.jsx)(A.a,{item:!0,sx:{p:1,width:"100%"},children:Object(L.jsx)(We,{id:o,name:u,description:j,complete:t,selectable:n,creatable:r,task:e,expand:l,refreshTasks:i})},e.id):Object(L.jsx)(A.a,{item:!0,style:{padding:10},children:Object(L.jsx)(Ee,{id:o,name:u,description:j,complete:t,selectable:n,creatable:r})},e.id)}))]})},Me=n(540),Re=function(e){var t=Object(d.g)().campaignId,n=Object(a.useContext)(U).currentUser,r=Object(a.useState)(0),i=Object(u.a)(r,2),s=i[0],o=i[1],l=Object(a.useState)([]),j=Object(u.a)(l,2),b=j[0],h=j[1],p=Object(a.useState)([]),f=Object(u.a)(p,2),g=f[0],m=f[1],v=Object(a.useState)([]),k=Object(u.a)(v,2),S=k[0],y=k[1],C=Object(a.useState)([]),w=Object(u.a)(C,2),_=w[0],I=w[1],T=Object(a.useState)(0),D=Object(u.a)(T,2),N=D[0],J=D[1],F=c.a.useState(1),P=Object(u.a)(F,2),B=P[0],z=P[1],G=function(){H(t).then((function(e){return R(e,h,J)})),K(t).then((function(e){return m(e)})),X(t).then((function(e){return y(e)})),function(e){return x.get("".concat(O,"user_relevant/?chain__campaign=").concat(e)).then((function(e){return e.data}))}(t).then((function(e){return I(e)}))};return Object(a.useEffect)((function(){G()}),[t]),n&&n.uid&&Object(L.jsxs)(A.a,{children:[Object(L.jsx)(qe,{creatable:!0,tasks:_}),Object(L.jsxs)(Te,{value:s,handleChange:function(e,t){o(t)},showSelectable:b.length>0,children:[Object(L.jsx)(Ce,{value:s,index:0,children:Object(L.jsx)(qe,{complete:!1,tasks:S})}),Object(L.jsx)(Ce,{value:s,index:1,children:Object(L.jsx)(qe,{complete:!0,tasks:g})}),b.length>0&&Object(L.jsxs)(Ce,{value:s,index:2,children:[Object(L.jsx)(qe,{selectable:!0,tasks:b,refreshTasks:G}),Object(L.jsx)(E.a,{pb:2,display:"flex",justifyContent:"center",children:Object(L.jsx)(Me.a,{count:N,page:B,onChange:function(e,n){z(n),n&&(0===s?X(t).then((function(e){return y(e)})):1===s?K(t).then((function(e){return m(e)})):2===s&&H(t,n).then((function(e){return R(e,h,J)})))},showFirstButton:!0,showLastButton:!0})})]})]})]})},Ve=function(){var e=Object(d.g)().id,t=Object(d.f)(),n=Object(a.useState)(""),c=Object(u.a)(n,2),r=c[0],i=c[1],s=Object(a.useState)(""),o=Object(u.a)(s,2),l=o[0],j=o[1],b=Object(a.useState)(""),h=Object(u.a)(b,2),O=h[0],f=h[1];Object(a.useEffect)((function(){console.log(p,e),function(e){return x.get(p+e+"/").then((function(e){return e.data}))}(e).then((function(e){var t=e.richText,n=e.name,a=e.description;n&&i(n),a&&j(a),t&&f(t)}))}),[e]);return Object(L.jsxs)("div",{style:{width:"70%",minWidth:"400px",margin:"0 auto",display:"block",padding:10},children:[Object(L.jsx)(N.a,{variant:"h3",align:"center",children:r}),Object(L.jsx)(N.a,{variant:"h6",align:"center",children:l}),O&&Object(L.jsx)(M,{data:O}),Object(L.jsx)(A.a,{container:!0,justifyContent:"center",style:{padding:20},children:Object(L.jsx)(oe.a,{variant:"contained",color:"primary",onClick:function(){(function(e){return x.post(p+e+"/join_campaign/")})(e).then((function(){return t.push("/campaign/".concat(e,"/tasks"))}))},children:"\u041f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f / \u041a\u043e\u0448\u0443\u043b\u0443\u0443"})})]})},He=function(){var e=Object(a.useContext)(U).currentUser;if(e){var t=localStorage.getItem("token");e.getIdToken(!1).then((function(e){t?e!==t&&(localStorage.setItem("token",e),window.location.reload()):(localStorage.setItem("token",e),window.location.reload())}))}return Object(L.jsx)("div",{children:Object(L.jsx)(pe.a,{children:Object(L.jsxs)(d.c,{children:[Object(L.jsx)(d.a,{exact:!0,path:"/campaign/about/:id",children:Object(L.jsx)(Ve,{})}),Object(L.jsx)(d.a,{path:"/campaign/:campaignId",children:Object(L.jsxs)(he,{children:[Object(L.jsx)(d.a,{exact:!0,path:"/campaign/:campaignId/tasks",children:Object(L.jsx)(Re,{})}),Object(L.jsx)(d.a,{exact:!0,path:"/campaign/:campaignId/tasks/:id",children:Object(L.jsx)(ee,{})})]})}),Object(L.jsx)(d.a,{path:"/",children:Object(L.jsx)(fe,{children:Object(L.jsx)(ke,{})})})]})})})},Ke=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,563)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(L.jsx)(W,{children:Object(L.jsx)(He,{})}),document.getElementById("root")),Ke()}},[[498,1,2]]]);
//# sourceMappingURL=main.20a1d12e.chunk.js.map